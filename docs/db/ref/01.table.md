# 운영 테이블 참조

> INS SQL 작성 시 참조할 기존 운영 DB 테이블

---

## 1. 테이블 관계도

```
┌─────────────┐
│   TA_FARM   │ ─────────────────────────────────────────┐
│  (농장)     │                                           │
└──────┬──────┘                                           │
       │ 1:N                                              │
       ▼                                                  │
┌─────────────┐     ┌─────────────┐                      │
│  TA_MEMBER  │     │ TC_CODE_FARM│ ◀────────────────────┤
│   (회원)    │     │ (농장코드)   │                      │
└─────────────┘     └─────────────┘                      │
                                                          │
┌─────────────┐                                           │
│  TB_MODON   │ ◀─────────────────────────────────────────┘
│ (모돈마스터) │
└──────┬──────┘
       │ 1:N (FARM_NO, PIG_NO)
       │
       ├──────────────┬──────────────┬──────────────┬──────────────┐
       ▼              ▼              ▼              ▼              ▼
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│ TB_MODON_WK │ │  TB_GYOBAE  │ │  TB_BUNMAN  │ │    TB_EU    │ │   TB_SAGO   │
│ (작업이력)   │ │   (교배)    │ │   (분만)    │ │   (이유)    │ │ (임신사고)  │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
       │
       │ 1:N
       ▼
┌──────────────────┐
│TB_MODON_JADON_TRANS│
│   (포유자돈)       │
└──────────────────┘
```

---

## 2. 모돈 관련 테이블

### TB_MODON (모돈 마스터)

```
PK: FARM_NO, PIG_NO
FK: FARM_NO → TA_FARM.FARM_NO
조건: OUT_DT = TO_DATE('99991231','YYYYMMDD') → 살아있음
인덱스:
  - IDX_TB_MODON (FARM_NO, PIG_NO) - UNIQUE
  - IDX_TB_MODON_01 (FARM_NO, FARM_PIG_NO, OUT_DT DESC, USE_YN) - FUNCTION-BASED
  - IDX_TB_MODON_02 (FARM_NO, HYULTONG_NO, OUT_DT DESC, USE_YN) - FUNCTION-BASED
  - IDX_TB_MODON_03 (FARM_NO, PIG_NO, OUT_DT DESC, USE_YN) - FUNCTION-BASED
  - IDX_TB_MODON_04 (FARM_NO, IN_DT DESC, OUT_DT DESC, USE_YN) - FUNCTION-BASED
  - IDX_TB_MODON_05 (FARM_NO)
  - IDX_TB_MODON_06 (FARM_NO, USE_YN)
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| FARM_NO | INTEGER | 농장번호 (PK, NOT NULL) |
| PIG_NO | INTEGER | 시스템번호 (PK, NOT NULL) |
| FARM_PIG_NO | VARCHAR2(40) | 개체번호 (NOT NULL) |
| PUMJONG_CD | VARCHAR2(6) | 품종코드 |
| IGAK_NO | VARCHAR2(40) | 이각번호 |
| BIRTH_DT | DATE | 출생일 (NOT NULL) |
| IN_DT | DATE | 전입일 (NOT NULL) |
| IN_SANCHA | INTEGER | 전입산차 (NOT NULL) |
| IN_GYOBAE_CNT | INTEGER | 전입교배차수 (NOT NULL) |
| IN_KG | NUMBER(5,2) | 전입체중 |
| STATUS_CD | VARCHAR2(6) | 상태코드 (NOT NULL, 010001~010008) |
| LAST_WK_DT | DATE | 최종작업일 |
| HYULTONG_NO | VARCHAR2(40) | 혈통번호 |
| MO_PIG_NO | VARCHAR2(40) | 모돈 개체번호 |
| UN_PIG_NO | VARCHAR2(40) | 부돈 개체번호 |
| MO_HYUL_NO | VARCHAR2(40) | 모돈 혈통번호 |
| UN_HYUL_NO | VARCHAR2(40) | 부돈 혈통번호 |
| OUT_DT | DATE | 도폐사일 (NOT NULL, 99991231=살아있음) |
| OUT_GUBUN_CD | VARCHAR2(6) | 도폐사 구분코드 |
| OUT_REASON_CD | VARCHAR2(6) | 도폐사 원인코드 |
| OUT_REASON_DETAIL | VARCHAR2(2000) | 도폐사 사유 |
| OUT_KG | NUMBER(8,2) | 판매체중 |
| RFID_NO | VARCHAR2(50) | 전자이표번호 |
| PSS | CHAR(1) | PSS |
| FAMILY_CD | VARCHAR2(6) | 가계코드 |
| BIGO | VARCHAR2(200) | 비고 |
| USE_YN | CHAR(1) | 사용여부 (NOT NULL) |
| LOG_INS_DT | DATE | 생성일 (NOT NULL) |
| LOG_UPT_DT | DATE | 수정일자 |
| LOG_INS_ID | VARCHAR2(40) | 생성자 |
| LOG_UPT_ID | VARCHAR2(40) | 수정자 |
| SALE_PRICE | NUMBER(14,2) | 판매금액 |
| IN_LOC_CD | INTEGER | 전입장소 |
| BUY_COM_CD | INTEGER | 구매처코드 |
| MOVE_IN_GUBUN | VARCHAR2(2) | 전입구분 (CJ용) |
| MOVE_FARM_NO | INTEGER | 전입출 농가코드 |
| MOVE_OUT_PIG_NO | INTEGER | 전출 모돈번호 |
| MOBILE | VARCHAR2(1) | 모바일 |
| MOBILE_DIE | VARCHAR2(1) | 모바일(도폐사용) |
| LOG_UPT_ID_DIE | VARCHAR2(40) | 수정자(도폐사용) |
| LOG_UPT_DT_DIE | DATE | 수정일(도폐사용) |
| EKAPE_SOW_NO | VARCHAR2(12) | 축평원 모돈번호 |
| SALE_COM_CD | INTEGER | 판매처코드 |

**트리거:**
- TRG_TB_MODON_01: UPDATE 전 이력 저장 (HIS_TB_MODON, HIS_MODON)
- TRG_TB_MODON_DEL_01: DELETE 후 이력 저장

---

### TB_MODON_WK (모돈 작업이력)

```
PK: FARM_NO, PIG_NO, WK_DT, WK_GUBUN
FK: FARM_NO, PIG_NO → TB_MODON
인덱스:
  - IDX_TB_MODON_WK (FARM_NO, PIG_NO, WK_DT, WK_GUBUN) - UNIQUE
  - IDX_TB_MODON_WK_01 (FARM_NO, PIG_NO, WK_DT, WK_GUBUN, SEQ, USE_YN)
  - IDX_TB_MODON_WK_02 (FARM_NO, PIG_NO, USE_YN, SEQ)
  - IDX_TB_MODON_WK_03 (FARM_NO, PIG_NO, WK_DATE, WK_GUBUN) - UNIQUE
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| FARM_NO | INTEGER | 농장번호 (PK, NOT NULL) |
| PIG_NO | INTEGER | 시스템번호 (PK, NOT NULL) |
| WK_DT | CHAR(8) | 작업일자 YYYYMMDD (PK, NOT NULL) |
| WK_GUBUN | CHAR(1) | 작업구분 A/G/B/E/F/Z (PK, NOT NULL) |
| WK_DATE | DATE | 작업일 (NOT NULL) |
| SANCHA | INTEGER | 산차 (NOT NULL) |
| GYOBAE_CNT | INTEGER | 교배차수 (NOT NULL) |
| LOC_CD | INTEGER | 돈방코드 |
| SAGO_GUBUN_CD | VARCHAR2(6) | 임신사고 구분코드 |
| DAERI_YN | CHAR(1) | 대리모여부 (Y/N) |
| SEQ | INTEGER | 일련번호 (NOT NULL) |
| USE_YN | CHAR(1) | 사용여부 (NOT NULL) |
| LOG_INS_DT | DATE | 생성일 |
| LOG_UPT_DT | DATE | 수정일자 |
| LOG_INS_ID | VARCHAR2(40) | 생성자 |
| LOG_UPT_ID | VARCHAR2(40) | 수정자 |
| AUTO_GB | VARCHAR2(1) | 자동생성 구분 (A=전입, Z=도폐사) |
| FW_NO | INTEGER | 분만틀번호 |
| MOBILE | VARCHAR2(1) | 모바일 |
| EKAPE_IUFLAG | VARCHAR2(1) | 축평원 (C=등록, U=수정, D=삭제) |
| EKAPE_WK_DT | VARCHAR2(8) | 축평원 전송작업일자 |

**트리거:**
- TRG_TB_MODON_WK_01: UPDATE 전 서브테이블 날짜 동기화 + 이력 저장
- TRG_TB_MODON_WK_DEL_01: DELETE 후 이력 저장 + TA_FARM_STATS_INFO 갱신
| PIG_NO | NUMBER | 돼지번호 (PK) |
| WK_DT | VARCHAR2(8) | 작업일 (PK) |
| WK_GUBUN | VARCHAR2(2) | 'G' 고정 (PK) |
| METHOD_1 | VARCHAR2(10) | 교배방법1 (자연/인공) |
| METHOD_2 | VARCHAR2(10) | 교배방법2 |
| METHOD_3 | VARCHAR2(10) | 교배방법3 |
| UNGDON_PIG_NO_1 | NUMBER | 웅돈1 돼지번호 |
| UNGDON_PIG_NO_2 | NUMBER | 웅돈2 돼지번호 |
| UNGDON_PIG_NO_3 | NUMBER | 웅돈3 돼지번호 |
| CHARGE_ID | VARCHAR2(20) | 담당자 ID |

---

### TB_BUNMAN (분만)

```
인덱스:
  - IDX_TB_BUNMAN (FARM_NO, PIG_NO, WK_DT, WK_GUBUN) - UNIQUE
  - IDX_TB_BUNMAN_01 (FARM_NO, WK_DT, WK_GUBUN, USE_YN)
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| FARM_NO | NUMBER | 농장번호 (PK) |
| PIG_NO | NUMBER | 돼지번호 (PK) |
| WK_DT | VARCHAR2(8) | 작업일 (PK) |
| WK_GUBUN | VARCHAR2(2) | 'B' 고정 (PK) |
| TOTAL_CNT | NUMBER | 총산자수 |
| LIVE_AM | NUMBER | 생존 수컷 |
| LIVE_SU | NUMBER | 생존 암컷 |
| DEAD_CNT | NUMBER | 사산두수 |
| MUMMY_CNT | NUMBER | 미라두수 |
| GIBUNG_CNT | NUMBER | 기형두수 |
| TOTAL_KG | NUMBER(10,2) | 총 체중 |
| AVG_KG | NUMBER(10,2) | 평균 체중 |

---

### TB_EU (이유)

```
인덱스:
  - IDX_TB_EU (FARM_NO, PIG_NO, WK_DT, WK_GUBUN) - UNIQUE
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| FARM_NO | NUMBER | 농장번호 (PK) |
| PIG_NO | NUMBER | 돼지번호 (PK) |
| WK_DT | VARCHAR2(8) | 작업일 (PK) |
| WK_GUBUN | VARCHAR2(2) | 'E' 고정 (PK) |
| DUSU | NUMBER | 이유두수 (수컷) |
| DUSU_SU | NUMBER | 이유두수 (암컷) |
| ILRYUNG | NUMBER | 포유일수 |
| TOTAL_KG | NUMBER(10,2) | 총 체중 |
| AVG_KG | NUMBER(10,2) | 평균 체중 |
| DAERI_YN | VARCHAR2(1) | 대리모 여부 |
| POLIM_CNT | NUMBER | 폐사두수 (포유중) |

---

### TB_SAGO (임신사고)

```
인덱스:
  - IDX_TB_SAGO (FARM_NO, PIG_NO, WK_DT, WK_GUBUN) - UNIQUE
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| FARM_NO | NUMBER | 농장번호 (PK) |
| PIG_NO | NUMBER | 돼지번호 (PK) |
| WK_DT | VARCHAR2(8) | 작업일 (PK) |
| WK_GUBUN | VARCHAR2(2) | 'F' 고정 (PK) |
| SAGO_GUBUN_CD | VARCHAR2(10) | 사고구분 (050001=재발, 050002=유산) |
| REMARK | VARCHAR2(500) | 비고 |

---

### TB_MODON_JADON_TRANS (포유자돈 이동)

```
인덱스:
  - IDX_TB_MODON_JADON_TRANS (FARM_NO, PIG_NO, SEQ) - UNIQUE
  - IDX_MODON_JADON_TRANS_01 (FARM_NO, WK_DT, GUBUN_CD)
  - IDX_MODON_JADON_TRANS_02 (FARM_NO, PIG_NO, WK_DT, GUBUN_CD)
  - IDX_TB_MODON_JADON_TRANS_01 (FARM_NO, PIG_NO, SANCHA)
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| FARM_NO | NUMBER | 농장번호 (PK) |
| PIG_NO | NUMBER | 모돈번호 (PK) |
| SEQ | NUMBER | 순번 (PK) |
| SANCHA | NUMBER | 산차 |
| GUBUN_CD | VARCHAR2(10) | 구분 (입식/출고) |
| WK_DT | VARCHAR2(8) | 작업일 |
| DUSU | NUMBER | 수컷 두수 |
| DUSU_SU | NUMBER | 암컷 두수 |
| BUN_DT | VARCHAR2(8) | 분만일 |
| EU_DT | VARCHAR2(8) | 이유일 |
| FROM_PIG_NO | NUMBER | 출발 모돈번호 |
| TO_PIG_NO | NUMBER | 도착 모돈번호 |

---

## 3. 농장/회원 테이블

### TA_FARM (농장)

```
PK: FARM_NO
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| FARM_NO | NUMBER | 농장번호 (PK) |
| FARM_NM | VARCHAR2(100) | 농장명 |
| PRINCIPAL_NM | VARCHAR2(50) | 대표자명 |
| SIDO_CD | VARCHAR2(10) | 시도코드 |
| SIGUN_CD | VARCHAR2(10) | 시군구코드 |
| COMPANY_CD | VARCHAR2(10) | 회사코드 |
| STOP_DT | VARCHAR2(8) | 서비스 중지일 |
| TEL_NO | VARCHAR2(20) | 전화번호 |
| HP_NO | VARCHAR2(20) | 휴대폰번호 |
| REG_DT | DATE | 등록일시 |

---

### TA_MEMBER (회원)

```
PK: MEMBER_ID
FK: FARM_NO → TA_FARM.FARM_NO
인덱스: IDX_TA_MEMBER_01 (FARM_NO)
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| MEMBER_ID | VARCHAR2(50) | 회원ID (PK) |
| FARM_NO | NUMBER | 농장번호 (FK) |
| COMPANY_CD | VARCHAR2(10) | 회사코드 |
| NAME | VARCHAR2(50) | 이름 |
| MEMBER_TYPE | VARCHAR2(10) | 회원유형 (ADMIN/USER) |
| PASSWORD | VARCHAR2(100) | 비밀번호 (암호화) |
| EMAIL | VARCHAR2(100) | 이메일 |
| USE_YN | VARCHAR2(1) | 사용여부 |
| REG_DT | DATE | 등록일시 |

---

## 4. 설정/코드 테이블

### TC_CODE_SYS (시스템코드)

```
PK: CODE, LANGUAGE_CD
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| CODE | VARCHAR2(20) | 코드 (PK) |
| LANGUAGE_CD | VARCHAR2(5) | 언어코드 ko/en/vi (PK) |
| PCODE | VARCHAR2(20) | 부모코드 |
| CNAME | VARCHAR2(100) | 코드명 |
| CVALUE | VARCHAR2(100) | 코드값 |
| SORT_NO | NUMBER | 정렬순서 |
| USE_YN | VARCHAR2(1) | 사용여부 |

---

### TC_CODE_FARM (농장코드)

```
PK: FARM_NO, CODE, CODE_GUBUN
FK: FARM_NO → TA_FARM.FARM_NO
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| FARM_NO | NUMBER | 농장번호 (PK) |
| CODE | VARCHAR2(20) | 코드 (PK) |
| CODE_GUBUN | VARCHAR2(20) | 코드구분 (PK) |
| CNAME | VARCHAR2(100) | 코드명 |
| CVALUE | VARCHAR2(100) | 코드값 |
| SORT_NO | NUMBER | 정렬순서 |
| USE_YN | VARCHAR2(1) | 사용여부 |

---

### TC_FARM_CONFIG (농가설정)

```
PK: FARM_NO, CONF_CD
FK: FARM_NO → TA_FARM.FARM_NO
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| FARM_NO | NUMBER | 농장번호 (PK) |
| CONF_CD | VARCHAR2(20) | 설정코드 (PK) |
| CONF_VALUE | VARCHAR2(100) | 설정값 |
| REG_DT | DATE | 등록일시 |

**주요 설정코드:**

| CONF_CD | 설명 | 기본값 |
|---------|------|--------|
| 901001 | 임신기간 | 114 |
| 901002 | 포유기간 | 21 |
| 901003 | 이유후대기 | 7 |

---

## 5. 기타 테이블

### TB_PLAN_MODON (예정작업)

```
PK: FARM_NO, SEQ
FK: FARM_NO → TA_FARM.FARM_NO
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| FARM_NO | NUMBER | 농장번호 (PK) |
| SEQ | NUMBER | 순번 (PK) |
| WK_NM | VARCHAR2(50) | 작업명 |
| STD_CD | VARCHAR2(10) | 기준작업코드 (020001~029999) |
| PASS_DAY | NUMBER | 경과일수 |
| MODON_STATUS_CD | VARCHAR2(10) | 대상모돈상태코드 (010001~019999) |
| JOB_GUBUN_CD | VARCHAR2(10) | 예정작업구분 (150001~150007) |
| BF_PASS_YN | VARCHAR2(1) | 경과일 이전 포함 여부 (Y/N) |
| S_SANCHA | NUMBER | 시작 산차 |
| E_SANCHA | NUMBER | 종료 산차 |
| HCODE | VARCHAR2(20) | 백신코드 (백신예정 시) |
| USE_YN | VARCHAR2(1) | 사용여부 |

**코드 참조:**
- STD_CD: 기준작업코드 (020001=출생, 020002=전입, 020003=교배, 020005=이유, 029999=전체)
- JOB_GUBUN_CD: 예정작업구분 (150001=임신진단, 150002=분만, 150003=이유, 150004=백신, 150005=교배)
- MODON_STATUS_CD: 019999=전체모돈

---

### TB_WT_BCS (체중/등지방)

```
PK: FARM_NO, PIG_NO, SEQ
FK: FARM_NO, PIG_NO → TB_MODON
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| FARM_NO | NUMBER | 농장번호 (PK) |
| PIG_NO | NUMBER | 돼지번호 (PK) |
| SEQ | NUMBER | 순번 (PK) |
| BCS_DT | VARCHAR2(8) | 측정일 |
| SANCHA | NUMBER | 산차 |
| BCS_KG | NUMBER(10,2) | 체중 (kg) |
| BCS | NUMBER(5,2) | 등지방 (mm) |
| MEASURE_GUBUN | VARCHAR2(10) | 측정구분 |

---

## 6. 코드 참조

### 작업구분 (WK_GUBUN)

| 코드 | 설명 | 상세 테이블 | 상태변경 |
|------|------|-------------|----------|
| A | 전입 | - | → 010001 (후보돈) |
| G | 교배 | TB_GYOBAE | → 010002 (임신돈) |
| B | 분만 | TB_BUNMAN | → 010003 (포유돈) |
| E | 이유 | TB_EU | → 010005 (이유모돈) |
| F | 임신사고 | TB_SAGO | → 010006/010007 |
| Z | 도폐사 | - | → 010008 (도폐사돈) |

### 상태코드 (STATUS_CD)

| 코드 | 설명 | 조건 |
|------|------|------|
| 010001 | 후보돈 | 미교배, 전입 직후 |
| 010002 | 임신돈 | 교배 후 |
| 010003 | 포유돈 | 분만 후 |
| 010004 | 대리모돈 | DAERI_YN='Y' |
| 010005 | 이유모돈 | 이유 후 |
| 010006 | 재발돈 | 사고(재발) |
| 010007 | 유산돈 | 사고(유산) SAGO_GUBUN_CD='050002' |
| 010008 | 도폐사돈 | 도폐사/전출 |

### 사고구분 (SAGO_GUBUN_CD)

| 코드 | 설명 |
|------|------|
| 050001 | 재발 |
| 050002 | 유산 |

---

## 7. 자주 사용하는 조인 패턴

### 모돈 현황 조회 (기준일 기준)

```sql
-- 기준일에 살아있는 모돈 + 마지막 작업
SELECT M.FARM_NO, M.PIG_NO, M.FARM_PIG_NO,
       W.WK_GUBUN, W.SANCHA, W.GYOBAE_CNT
FROM TB_MODON M
LEFT JOIN (
    SELECT FARM_NO, PIG_NO, WK_GUBUN, SANCHA, GYOBAE_CNT,
           ROW_NUMBER() OVER (
               PARTITION BY FARM_NO, PIG_NO
               ORDER BY WK_DATE DESC, SEQ DESC
           ) RN
    FROM TB_MODON_WK
    WHERE WK_DATE <= :P_BASE_DATE
) W ON M.FARM_NO = W.FARM_NO
   AND M.PIG_NO = W.PIG_NO
   AND W.RN = 1
WHERE M.FARM_NO = :P_FARM_NO
  AND M.IN_DT <= TO_CHAR(:P_BASE_DATE, 'YYYYMMDD')
  AND M.OUT_DT > TO_CHAR(:P_BASE_DATE, 'YYYYMMDD');
```

### 교배 상세 조회

```sql
SELECT W.*, G.METHOD_1, G.UNGDON_PIG_NO_1
FROM TB_MODON_WK W
JOIN TB_GYOBAE G ON W.FARM_NO = G.FARM_NO
                AND W.PIG_NO = G.PIG_NO
                AND W.WK_DT = G.WK_DT
                AND W.WK_GUBUN = G.WK_GUBUN
WHERE W.WK_GUBUN = 'G';
```

---

## 8. 출하 데이터 테이블

### TM_LPD_DATA (도축 출하 데이터)

```
인덱스:
  - IDX_TM_LPD_DATA_00 (FARM_NO, DOCHUK_DT, DOCHUK_NO, FACTORY_CD) - UNIQUE
  - IDX_TM_LPD_DATA_01 (FARM_NO, UPLOAD_KEY, LOG_UPT_ID)
  - IDX_TM_LPD_DATA_02 (FARM_NO, EKAPE_FARM_NO, EKAPE_ANIMAL_SEQ)
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| LPD_SEQ | NUMBER | 일련번호 (PK, NOT NULL) |
| FARM_NO | NUMBER | 농장번호 (FK, NOT NULL) |
| DOCHUK_NO | VARCHAR2(50) | 도축장코드 |
| DOCHUK_NM | VARCHAR2(200) | 도축장명 |
| DOCHUK_DT | VARCHAR2(10) | 도축일 (YYYY-MM-DD 형식) |
| NET_KG | NUMBER(8,2) | 지육체중(도체중) kg |
| NET_KG_AVG | NUMBER(8,2) | 평균 지육체중 |
| BACK_DEPTH | NUMBER(8,2) | 등지방두께 mm |
| BACK_DEPTH_AVG | NUMBER(8,2) | 평균 등지방두께 |
| MEAT_QUALITY | VARCHAR2(6) | 육질(최종등급) 1+/1/2/등외 |
| SEX_GUBUN | VARCHAR2(10) | 성별구분 |
| AU_PRICE | NUMBER(10,2) | 경락단가 원/kg |
| PORK_PRICE | NUMBER(10,2) | 돈육시세 |
| NATIONAL_PRICE | NUMBER(10,2) | 전국평균가 |
| LIVE_KG | NUMBER(8,2) | 생체중 kg |
| PIGLET_NO | VARCHAR2(50) | 개체번호 |
| IGAK_NO | VARCHAR2(50) | 이각번호 |
| BIRTH_DT | VARCHAR2(10) | 출생일 |
| TRANS_DT | VARCHAR2(10) | 전송일 |
| REMARK | VARCHAR2(500) | 비고 |
| USE_YN | VARCHAR2(1) | 사용여부 (Y/N) |
| LOG_INS_DT | DATE | 등록일시 |
| LOG_UPT_DT | DATE | 수정일시 |

**주요 조회 패턴:**

```sql
-- 주간 출하 데이터 조회 (기간별)
SELECT DOCHUK_DT, COUNT(*) CNT,
       ROUND(AVG(NET_KG), 1) AVG_NET_KG,
       ROUND(AVG(BACK_DEPTH), 1) AVG_BACK_DEPTH
FROM TM_LPD_DATA
WHERE FARM_NO = :P_FARM_NO
  AND DOCHUK_DT BETWEEN :P_FROM_DT AND :P_TO_DT
  AND USE_YN = 'Y'
GROUP BY DOCHUK_DT
ORDER BY DOCHUK_DT;

-- 등급별 분포 조회
SELECT MEAT_QUALITY,
       COUNT(*) CNT,
       ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 1) PCT
FROM TM_LPD_DATA
WHERE FARM_NO = :P_FARM_NO
  AND DOCHUK_DT BETWEEN :P_FROM_DT AND :P_TO_DT
  AND USE_YN = 'Y'
GROUP BY MEAT_QUALITY;
```

---

## 9. 시세 데이터 테이블

### TM_SISAE (경락가격 일별 탕박/박피 단가)

```
설명: 경락가격 일별 탕박, 박피 단가 정보 (TM_SISAE_DETAIL 트리거에서 자동 집계)
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| BUT_DT | DATE | 도축일 (PK) |
| TANG_DUSU | INTEGER | 탕박 경락두수 |
| TANG_DANGA | NUMBER | 탕박 평균단가 (원/kg) |
| BAK_DUSU | INTEGER | 박피 경락두수 |
| BAK_DANGA | NUMBER | 박피 평균단가 (원/kg) |

**데이터 흐름:**
```
TM_SISAE_DETAIL (상세 시세)
    ↓ INSERT/UPDATE 트리거
TM_SISAE (탕박/박피 요약)
```

**참고:** 트리거를 통해 `TM_SISAE_DETAIL`에서 자동 집계되나, 주간 리포트에서는 `TM_SISAE_DETAIL`을 직접 조회하여 정밀한 조건(GRADE_CD='ST' 등)으로 계산함.

---

### TM_SISAE_DETAIL (경락가격 일별 시세 상세내역)

```
설명: 경락가격 상세정보 (시세 등록 시 탕박, 박피 두수/금액 집계 트리거 포함)
인덱스:
  - IDX_TM_SISAE_DETAIL_01 (ABATTCD, START_DT, GRADE_TYPE, GRADE_CD, SKIN_YN, JUDGESEX_CD)
  - IDX_TM_SISAE_DETAIL_02 (ABATTCD, SKIN_YN, GRADE_TYPE, GRADE_CD, JUDGESEX_CD, START_DT)
```

| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| ABATTCD | VARCHAR2(20) | 도매시장코드(전국,제주제외) |
| GRADE_TYPE | VARCHAR2(100) | 등급구분 |
| START_DT | VARCHAR2(10) | 시작일 |
| GRADE_CD | VARCHAR2(100) | 등급코드 |
| GRADE_NM | VARCHAR2(100) | 등급명 |
| SKIN_YN | VARCHAR2(1) | 박피/탕박구분여부 |
| SKIN_NM | VARCHAR2(20) | 박피/탕박구분 |
| JUDGESEX_CD | VARCHAR2(6) | 성별코드 |
| JUDGESEX_NM | VARCHAR2(20) | 성별 |
| AUCTCNT | INTEGER | 경락두수 |
| WEIGHT | NUMBER | 평균 도체중 |
| MIN_AUCTAMT | NUMBER | 최저 단가 |
| MAX_AUCTAMT | NUMBER | 최고 단가 |
| AUCTAMT | NUMBER | 평균 가격 |
| SUM_AUCTAMT | NUMBER | 거래대금(원) |
| SUM_WEIGHT | NUMBER | 거래중량(kg) |

**트리거:**
- TRG_TM_SISAE_DETAIL_INSERT_01: 시세 등록 시 탕박, 박피 두수/금액을 TM_SISAE 테이블로 집계 (INSERT 시)
- TRG_TM_SISAE_DETAIL_UPDATE_01: 시세 등록 시 탕박, 박피 두수/금액을 TM_SISAE 테이블로 집계 (UPDATE 시)

**주요 코드값:**

| GRADE_CD | 설명 |
|----------|------|
| 029068 | 1+ 등급 |
| 029069 | 1 등급 |
| 029070 | 2 등급 |
| 029076 | 등외 |
| ST | 등외제외 전체 (★ 전국 탕박 평균 계산 시 사용) |
| SU | 모돈 |
| T | 평균 |

| ABATTCD | 설명 |
|---------|------|
| 057016 | 전국 (제주 제외) |

| SKIN_YN | 설명 |
|---------|------|
| Y | 탕박 |
| N | 박피 |

**주요 조회 패턴:**

```sql
-- 주간 전국 탕박 평균 단가 조회 (SP_INS_WEEK_FARM_PROCESS)
-- 조건: ABATTCD='057016'(전국), GRADE_CD='ST'(등외제외 전체), SKIN_YN='Y'(탕박)
SELECT NVL(ROUND(SUM(AUCTCNT * AUCTAMT) / NULLIF(SUM(AUCTCNT), 0)), 0)
FROM TM_SISAE_DETAIL
WHERE ABATTCD = '057016'
  AND START_DT BETWEEN :P_DT_FROM AND :P_DT_TO
  AND GRADE_CD = 'ST'
  AND SKIN_YN = 'Y'
  AND JUDGESEX_CD IS NULL
  AND TO_NUMBER(NVL(AUCTAMT, '0')) > 0;
```

---

## 10. 테이블 데이터 건수 확인 SQL

### 10.1 전체 테이블 건수 확인
전체적인 데이터 규모를 파악하여 인덱스 전략 및 쿼리 최적화 필요성을 판단합니다.

```sql
SELECT 'TA_FARM' AS TABLE_NM, COUNT(*) AS CNT FROM TA_FARM
UNION ALL SELECT 'TB_MODON', COUNT(*) FROM TB_MODON
UNION ALL SELECT 'TB_MODON_WK', COUNT(*) FROM TB_MODON_WK
UNION ALL SELECT 'TB_GYOBAE', COUNT(*) FROM TB_GYOBAE
UNION ALL SELECT 'TB_BUNMAN', COUNT(*) FROM TB_BUNMAN
UNION ALL SELECT 'TB_EU', COUNT(*) FROM TB_EU
UNION ALL SELECT 'TB_SAGO', COUNT(*) FROM TB_SAGO
UNION ALL SELECT 'TM_LPD_DATA', COUNT(*) FROM TM_LPD_DATA
UNION ALL SELECT 'TM_SISAE_DETAIL', COUNT(*) FROM TM_SISAE_DETAIL;
```

### 10.2 특정 농장 데이터 건수 확인
개별 농장 처리 프로시저(`SP_INS_WEEK_FARM_PROCESS`)의 부하를 예측합니다.

```sql
SELECT 'TB_MODON' AS TABLE_NM, COUNT(*) AS CNT FROM TB_MODON WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TB_MODON_WK', COUNT(*) FROM TB_MODON_WK WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TB_EU', COUNT(*) FROM TB_EU WHERE FARM_NO = :P_FARM_NO
UNION ALL SELECT 'TM_LPD_DATA', COUNT(*) FROM TM_LPD_DATA WHERE FARM_NO = :P_FARM_NO;
```

### 10.3 최근 6개월 데이터 건수 (육성율 계산 관련)
`SP_INS_WEEK_CONFIG`에서 수행하는 육성율 계산 쿼리의 대상 범위를 확인합니다.

```sql
-- 출하 데이터 (최근 6개월)
SELECT COUNT(*) AS SHIP_CNT_6M
FROM TM_LPD_DATA
WHERE FARM_NO = :P_FARM_NO
  AND DOCHUK_DT >= TO_CHAR(ADD_MONTHS(SYSDATE, -6), 'YYYY-MM-DD');

-- 이유 데이터 (최근 6개월 + Offset 약 160일)
SELECT COUNT(*) AS WEAN_CNT_6M
FROM TB_EU
WHERE FARM_NO = :P_FARM_NO
  AND WK_DT >= TO_CHAR(ADD_MONTHS(SYSDATE, -6) - 180, 'YYYYMMDD');
```

---

## 관련 문서

- [02.view.md](02.view.md) - VW_MODON_DATE_2020_MAX_WK
- [03.function.md](03.function.md) - SF_GET_MODONGB_STATUS
